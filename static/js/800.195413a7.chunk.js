"use strict";(self.webpackChunkmia_erp=self.webpackChunkmia_erp||[]).push([[800,495],{5800:function(e,n,t){t.r(n),t.d(n,{useCustomersTableSettings:function(){return P}});var i,r=t(168),a=t(1413),o=t(9439),l=t(8589),d=t(8495),u=t(3350),c=t(2791),s=t(6931),f=t(1186),h=t(1819),m=t(7348),v=t(3665),p=t(7665),Z=t(763),b=t.n(Z),x=t(387),g=t(1383),S=t(3329),j=u.ZP.div(i||(i=(0,r.Z)(["\n  ","\n"])),d.VU);n.default=function(e){var n=(0,c.useState)(!1),t=(0,o.Z)(n,2),i=t[0],r=t[1],d=(0,v.kw)(),u=(0,m.I6)(),Z=(0,c.useState)(),P=(0,o.Z)(Z,2),C=P[0],y=P[1],w=(0,c.useState)(),k=(0,o.Z)(w,2),_=k[0],q=k[1],E=(0,h.xc)()[h.EJ.customers],F=(0,c.useMemo)((function(){return{tableData:u.customers,tableTitles:f.f,hasFilter:!0,hasSearch:!0,showFooter:!1,checkBoxes:!0,actionsCreator:function(e){var n=null===e||void 0===e?void 0:e.selectedRow;return[{icon:"refresh",onClick:function(){E.getAll({data:{refresh:!0,params:{}}})}},{separator:!0},{icon:"edit",type:"onlyIcon",onClick:function(){var e=d.open({ModalChildren:p.Z,modalChildrenProps:{defaultState:u.customers.find((function(e){return e._id===(null===n||void 0===n?void 0:n._id)})),onSubmit:function(t){E.update({data:{data:{data:(0,x.vg)(t),_id:null===n||void 0===n?void 0:n._id},refresh:!0},onSuccess:function(n,t){console.log("edit customer P",n),(null===e||void 0===e?void 0:e.onClose)&&(null===e||void 0===e||e.onClose())}})}}})}},{separator:!0},{icon:"plus",type:"onlyIconFilled",onClick:function(){var e=d.open({ModalChildren:p.Z,modalChildrenProps:{withReferer:!0,onSubmit:function(n){var t;E.create({data:{data:null!==n&&void 0!==n&&null!==(t=n.referrer)&&void 0!==t&&t._id?(0,x.vg)(n):(0,x.vg)(b().omit(n,["referrer"]))},onSuccess:function(n){g.kl.success("New user created: ".concat(null===n||void 0===n?void 0:n.email)),(null===e||void 0===e?void 0:e.onClose)&&(null===e||void 0===e||e.onClose())}})}}})}}]},onFilterSubmit:function(e){q(e)},onTableSortChange:function(e,n){y({sortPath:e.dataPath,sortOrder:n})}}}),[d,E,u.customers]);return(0,c.useEffect)((function(){C||_||C||_||0===u.customers.length&&E.getAll({data:{refresh:!0,params:{}},onLoading:r})}),[_,E,C,u.customers.length]),(0,S.jsx)(s.default,{path:e.path,children:(0,S.jsx)(j,{children:(0,S.jsx)(l.ZP,(0,a.Z)((0,a.Z)({},F),{},{isLoading:i}))})})};var P=function(){var e=(0,c.useState)(),n=(0,o.Z)(e,2),t=n[0],i=n[1],r=(0,c.useState)(),a=(0,o.Z)(r,2),l=a[0],d=a[1],u=(0,c.useMemo)((function(){return{hasFilter:!0,hasSearch:!0,showFooter:!1,checkBoxes:!0,onFilterSubmit:function(e){d(e)},onTableSortChange:function(e,n){i({sortPath:e.dataPath,sortOrder:n})}}}),[]);return(0,c.useEffect)((function(){}),[l,t,u]),{tableConfig:u,sortParams:t,filterParams:l}}},8495:function(e,n,t){t.d(n,{SI:function(){return u},VU:function(){return d}});var i,r,a,o=t(168),l=t(3350),d=(0,l.iv)(i||(i=(0,o.Z)(["\n  grid-column: 1/13;\n  grid-row: 1/13;\n"]))),u=(0,l.iv)(r||(r=(0,o.Z)(["\n  width: 100%;\n  height: 100%;\n"])));(0,l.iv)(a||(a=(0,o.Z)(["\n  outline: 1px solid tomato;\n"])))},7665:function(e,n,t){t.d(n,{Z:function(){return D}});var i,r=t(168),a=t(1413),o=t(4925),l=function(e){return e.facebook="facebook",e.instagram="instagram",e.referralSystem="referralSystem",e.another="another",e}({}),d=t(9656),u=t(3544),c=t(3350),s=t(8095),f=t(4990),h=t(6681),m=t(9964),v=t(457),p=t(1134),Z=t(2928),b=t(1392),x=t(8553),g=t(2791),S=t(1383),j=t(5611),P=t(763),C=t.n(P),y=t(3329),w=["defaultState","withReferer","onSubmit"],k=["register","setValue","handleSubmit","watch"],_=S.E4.isDevMode(),q=(0,x.H1)(l),E=(0,c.ZP)(s.ZP)(i||(i=(0,r.Z)([""]))),F=function(e){var n=e.form,t=[{name:"first",label:(0,u.t)("First name"),required:!0},{name:"second",label:(0,u.t)("Second name")},{name:"middle",label:(0,u.t)("Middle name")}];return(0,y.jsx)(y.Fragment,{children:t.map((function(e){var t=e.name,i=e.label,r=e.required;return(0,y.jsx)(f.Z,{label:i,required:r,children:(0,y.jsx)(h.ZP,(0,a.Z)((0,a.Z)({placeholder:i},n.register("name.".concat(t),{required:r})),{},{required:r}))},"name_".concat(t))}))})},I=function(e){var n=e.form,t=[{name:"base",label:(0,u.t)("Label"),required:!0},{name:"print",label:(0,u.t)("Print label")}];return(0,y.jsx)(y.Fragment,{children:t.map((function(e){var t=e.name,i=e.label,r=e.required;return(0,y.jsx)(f.Z,{label:i,required:r,children:(0,y.jsx)(h.ZP,(0,a.Z)((0,a.Z)({placeholder:i},n.register("label.".concat(t),{required:r})),{},{required:r}))},"name_".concat(t))}))})},D=function(e){var n=e.defaultState,t=e.withReferer,i=e.onSubmit,r=(0,o.Z)(e,w),c=(0,p.cI)({defaultValues:(0,a.Z)((0,a.Z)({},n),{},{businessType:j.GE.company})}),x=c.register,S=c.setValue,P=c.handleSubmit,D=c.watch,T=(0,o.Z)(c,k),M=D(),R=(0,g.useMemo)((function(){return!(null===n||void 0===n||!n.email)}),[null===n||void 0===n?void 0:n.email]);return(0,y.jsx)(d.Z,(0,a.Z)((0,a.Z)({fillHeight:!0},r),{},{title:r.title?r.title:(0,u.t)("Create customer"),onSubmit:P((function(e){i&&i(C().omit(e,R?["engagementSource","email"]:["engagementSource"]))})),children:(0,y.jsxs)(E,{padding:"0 8px 8px",children:[(0,y.jsx)(f.Z,{label:(0,u.t)("type"),required:!0,children:(0,y.jsx)(m.Z,{options:v.Wk,onSelect:function(e){S("businessType",null===e||void 0===e?void 0:e.value)}})}),M.businessType!==j.GE.person&&(0,y.jsx)(I,{form:(0,a.Z)({register:x,setValue:S,handleSubmit:P,watch:D},T)}),M.businessType!==j.GE.company&&(0,y.jsx)(F,{form:(0,a.Z)({register:x,setValue:S,handleSubmit:P,watch:D},T)}),(0,y.jsx)(f.Z,{label:(0,u.t)("email"),disabled:R,required:!0,children:(0,y.jsx)(h.ZP,(0,a.Z)((0,a.Z)({placeholder:(0,u.t)("email"),type:"email"},x("email",{required:!0})),{},{disabled:R,required:!0}))}),(0,y.jsx)(f.Z,{label:(0,u.t)("phone"),children:(0,y.jsx)(h.ZP,(0,a.Z)({placeholder:(0,u.t)("phone")},x("phone")))}),M.businessType!==j.GE.company&&(0,y.jsx)(f.Z,{label:(0,u.t)("Birth date"),children:(0,y.jsx)(h.ZP,(0,a.Z)((0,a.Z)({placeholder:(0,u.t)("Birth date")},x("birthDate")),{},{type:"datetime-local"}))}),t&&_&&(0,y.jsx)(f.Z,{label:(0,u.t)("Referrer id"),children:(0,y.jsx)(h.ZP,(0,a.Z)({placeholder:(0,u.t)("Referrer id")},x("referrer._id")))}),(0,y.jsx)(f.Z,{label:(0,u.t)("Source"),children:(0,y.jsx)(b.Z,{disabled:!0,options:q,currentOption:{value:null===M||void 0===M?void 0:M.engagementSource},onChangeIndex:function(e){S("engagementSource",q[e].value)}})}),(null===M||void 0===M?void 0:M.engagementSource)===l.referralSystem&&(0,y.jsxs)(s.ZP,{gap:8,fillWidth:!0,children:[(0,y.jsx)(f.Z,{label:(0,u.t)("Referrer"),required:!0,children:(0,y.jsx)(h.ZP,{placeholder:(0,u.t)("Referrer"),type:"email",required:!0})}),(0,y.jsxs)(s.ZP,{fxDirection:"row",fillWidth:!0,gap:8,padding:"8px 0",children:[(0,y.jsx)(Z.ZP,{variant:"defaultSmall",children:(0,u.t)("Clear referrer")}),(0,y.jsx)(Z.ZP,{variant:"outlinedSmall",flex:1,children:(0,u.t)("Select referrer")})]})]})]})}))}},1392:function(e,n,t){var i=t(3433),r=t(9439),a=t(2791),o=t(7049),l=t(8095),d=t(3855),u=t(6492),c=t(3329);n.Z=function(e){var n=e.options,t=e.onChangeIndex,s=e.currentIndex,f=e.currentOption,h=e.multiple,m=e.onChange,v=e.value,p=e.disabled,Z=e.disabledCheck,b=e.renderLabel,x=(0,a.useState)(0),g=(0,r.Z)(x,2),S=g[0],j=g[1],P=(0,a.useState)([]),C=(0,r.Z)(P,2),y=C[0],w=C[1],k=(0,a.useCallback)((function(e){h?w((function(n){var t=y.includes(e)?n.filter((function(n){return n!==e})):[].concat((0,i.Z)(n),[e]);return m&&m(t),t})):(w([e]),m&&m([e]))}),[h,m,y]),_=(0,a.useCallback)((function(e){t?t(e):j(e)}),[t]),q=(0,a.useMemo)((function(){return null===n||void 0===n?void 0:n.map((function(e,n){var t=Z?Z(e,n):p;return(0,c.jsxs)(l.ZP,{fxDirection:"row",gap:8,padding:"2px 4px",alignItems:"center",style:{opacity:t?.7:1,pointerEvents:t?"none":"all"},onClick:function(){t||(_(n),(null===e||void 0===e?void 0:e._id)&&k(null===e||void 0===e?void 0:e._id))},children:[(0,c.jsx)(d.Z,{checked:(null===e||void 0===e?void 0:e._id)&&y.includes(null===e||void 0===e?void 0:e._id)||n===S,size:"22px",disabled:t}),b?b({option:e,index:n,checked:(null===e||void 0===e?void 0:e._id)&&y.includes(null===e||void 0===e?void 0:e._id)||n===S}):(0,c.jsx)(u.x,{children:null===e||void 0===e?void 0:e.label})]},"m-opt_".concat(e.value))}))}),[S,p,Z,k,_,n,b,y]);return(0,a.useEffect)((function(){o.sr.isUnd(s)||j(s)}),[s]),(0,a.useEffect)((function(){h||o.sr.isUnd(f)||o.sr.isUnd(n)||j(n.findIndex((function(e){return(null===e||void 0===e?void 0:e.value)===(null===f||void 0===f?void 0:f.value)||(null===e||void 0===e?void 0:e._id)===(null===f||void 0===f?void 0:f._id)})))}),[f,h,n]),(0,a.useEffect)((function(){h&&!o.sr.isUnd(v)&&o.sr.isArray(v)&&w(v)}),[h,v]),(0,c.jsx)(l.ZP,{fillWidth:!0,gap:8,children:q})}},1186:function(e,n,t){t.d(n,{f:function(){return r}});var i=t(3544),r=[{top:{name:"".concat((0,i.t)("label"),"/").concat((0,i.t)("name")),getData:function(e){var n,t=null!==(n=e.label)&&void 0!==n?n:e.name;return t?Object.values(t).map((function(e){return null!==e&&void 0!==e?e:""})).join(" "):"---"}},bottom:{name:"\u0406\u041f\u041d/\u0404\u0414\u0420\u041f\u041e\u0423",getData:function(e){var n,t;return((null===(n=e.taxCode)||void 0===n?void 0:n.personal)||"---")+"/"+((null===(t=e.taxCode)||void 0===t?void 0:t.corp)||"---")}},width:"240px",action:"doubleDataWithAvatar"},{top:{name:"\u0422\u0438\u043f",getData:function(e){return null===e||void 0===e?void 0:e.type}},bottom:{name:"\u0421\u0442\u0430\u0442\u0443\u0441",path:"status"},width:"120px",action:"valueByPath"},{top:{name:"\u0415\u043c\u0435\u0439\u043b",path:"email",uppercase:!1},bottom:{name:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",path:"phone"},width:"170px",action:"contacts"},{top:{name:"\u041b\u043e\u043a\u0430\u0446\u0456\u044f"},width:"170px",action:"valueByPath"},{top:{name:"\u0422\u0435\u0433\u0438",path:"tags"},width:"200px",action:"tags"},{top:{name:"\u041a\u043e\u043c\u0435\u043d\u0442\u0430\u0440",path:"description"},width:"170px",action:"valueByPath"},{top:{name:"\u0421\u0442\u0432\u043e\u0440\u0435\u043d\u043e",align:"center",path:"createdAt"},bottom:{name:"\u041e\u043d\u043e\u0432\u043b\u0435\u043d\u043e",align:"center",path:"updatedAt"},width:"150px",action:"dateSimple"}]}}]);
//# sourceMappingURL=800.195413a7.chunk.js.map