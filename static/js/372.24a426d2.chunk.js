"use strict";(self.webpackChunkmia_erp=self.webpackChunkmia_erp||[]).push([[372],{7372:function(t,e,n){n.r(e),n.d(e,{default:function(){return M}});var a=n(168),i=n(1413),o=n(4925),r=n(9656),d=n(4990),l=n(6681),u=n(3350),c=n(8553),v=n(1709),p=n(3544),s=n(2989),h=n(7348),m=n(2791),f=n(1819),g=n(401),b=n(8095),w=n(8589),x=n(6981),y=n(387),D=n(4695),P=n(6727),Z=n(2092),_=n(758),S=n(7049);var j,k,B,C=n(3329),q=["product"],A=(0,c.H1)(v.a),I=P.Ry().shape({amount:P.Rx().min(1).required(),variation:P.Ry().shape({_id:P.Z_().required()}).required(),price:P.Ry().shape({_id:P.Z_().required()}).required()}),W=[{name:"amount",type:"number",label:(0,p.t)("quantity"),placeholder:(0,p.t)("quantity")},{name:"batch",label:(0,p.t)("batch"),placeholder:(0,p.t)("batch")}],R=(0,u.ZP)(r.Z)(j||(j=(0,a.Z)(["\n  //@media screen and (min-width: 480px) {\n  //  width: fit-content;\n  //  max-width: 960px;\n  //}\n"]))),E=(0,u.ZP)(b.ZP)(k||(k=(0,a.Z)(["\n  //@media screen and (min-width: 768px) {\n  //  display: grid;\n  //  grid-template-columns: 2fr 1fr;\n  //}\n"]))),F=u.ZP.div(B||(B=(0,a.Z)(["\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 8px;\n  justify-content: center;\n\n  width: 100%;\n\n  padding: 0 8px 8px;\n"]))),M=function(t){var e,n=t.product,a=(0,o.Z)(t,q),r=(0,f.xc)().products,u=(0,h.i7)().currentOffer,c=(0,h.eO)().warehouses,P=(0,m.useMemo)((function(){return n||u}),[u,n]),j=(0,s.hN)({defaultValues:(0,i.Z)((0,i.Z)({amount:0,type:v.a.addToStock},null===a||void 0===a?void 0:a.defaultState),{},{product:P?(0,y.rE)(P):void 0}),resolver:(0,D.X)(I),reValidateMode:"onSubmit"}),k=j.register,B=j.setValue,M=j.formValues,N=j.formState.errors,O=j.unregister,T=j.handleSubmit,V=function(){var t,e=(0,h.i7)().currentOffer,n=(0,h.WS)();return(0,m.useMemo)((function(){var t=n.find((function(t){var n;return t._id===(null===e||void 0===e||null===(n=e.template)||void 0===n?void 0:n._id)}));return(0,S.F9)(t)}),[null===e||void 0===e||null===(t=e.template)||void 0===t?void 0:t._id,n])}(),L=(0,m.useMemo)((function(){var t;return null!==P&&void 0!==P&&P.variations?null===P||void 0===P||null===(t=P.variations)||void 0===t?void 0:t.map((function(t){return(0,g.m$)(t)})):[]}),[null===P||void 0===P?void 0:P.variations]),X=(0,m.useMemo)((function(){var t;return null===u||void 0===u||null===(t=u.prices)||void 0===t?void 0:t.filter((function(t){var e,n;return(null===(e=t.variation)||void 0===e?void 0:e._id)===(null===(n=M.variation)||void 0===n?void 0:n._id)}))}),[null===u||void 0===u?void 0:u.prices,M.variation]);(0,m.useEffect)((function(){console.log(X),console.log("currentProduct?.prices",null===u||void 0===u?void 0:u.prices)}),[X,null===u||void 0===u?void 0:u.prices]);var H=(0,m.useCallback)((function(t){var e;(null===t||void 0===t?void 0:t.rowId)!==(null===(e=M.variation)||void 0===e?void 0:e._id)&&(O("price"),(null===t||void 0===t?void 0:t.rowId)&&B("variation",{_id:t.rowId}))}),[null===(e=M.variation)||void 0===e?void 0:e._id,B,O]);(0,m.useEffect)((function(){console.log(M.variation)}),[M.variation]);var K=(0,m.useCallback)((function(t){(null===t||void 0===t?void 0:t.rowId)&&B("price._id",null===t||void 0===t?void 0:t.rowId)}),[B]),Q=(0,m.useCallback)((function(t){(null===t||void 0===t?void 0:t.rowId)&&B("warehouse._id",null===t||void 0===t?void 0:t.rowId)}),[B]);return(0,m.useEffect)((function(){n&&(null===u||void 0===u?void 0:u._id)!==(null===n||void 0===n?void 0:n._id)&&r.getProductFullInfo({data:(0,y.rE)(n)})}),[null===u||void 0===u?void 0:u._id,n,r]),(0,C.jsx)(R,(0,i.Z)((0,i.Z)({title:"Create new warehouse document",width:"960px"},a),{},{options:A,onOptSelect:function(t,e,n){B("type",e)},onSubmit:T((function(t){console.log("FormCreateWarehouseDocumentFormData",t),(0,Z.Eh)({data:{data:t},onSuccess:function(t){console.log("FormCreateWarehouseDocument success",t),(null===a||void 0===a?void 0:a.onClose)&&(null===a||void 0===a||a.onClose())},onError:function(t){console.error("FormCreateWarehouseDocument err ",t)}},Z.nh.createDocument,Z.nh)})),extraFooter:(0,C.jsx)(F,{children:W.map((function(t){return(0,C.jsx)(d.Z,{label:null===t||void 0===t?void 0:t.label,disabled:null===t||void 0===t?void 0:t.disabled,required:null===t||void 0===t?void 0:t.required,children:(0,C.jsx)(l.ZP,(0,i.Z)({align:"number"===(null===t||void 0===t?void 0:t.type)?"center":"left",disabled:null===t||void 0===t?void 0:t.disabled,type:null===t||void 0===t?void 0:t.type,required:null===t||void 0===t?void 0:t.required,placeholder:null===t||void 0===t?void 0:t.placeholder},k(t.name,{required:null===t||void 0===t?void 0:t.required,valueAsNumber:"number"===(null===t||void 0===t?void 0:t.type)})))},"".concat(null===t||void 0===t?void 0:t.name))}))}),children:(0,C.jsx)(E,{padding:"0 0 8px",overflow:"auto",gap:8,children:(0,C.jsxs)(b.ZP,{fillWidth:!0,alignItems:"stretch",children:[(0,C.jsx)(d.Z,{label:(0,p.t)("Select warehouse"),error:N.warehouse,children:(0,C.jsx)(b.ZP,{fillWidth:!0,style:{height:250},overflow:"hidden",padding:"0 2px",children:(0,C.jsx)(w.ZP,{tableTitles:_.A7,tableData:c,hasSearch:!1,onRowClick:Q})})}),(0,C.jsx)(d.Z,{label:(0,p.t)("Select variation"),error:N.variation,children:(0,C.jsx)(b.ZP,{fillWidth:!0,style:{height:250},overflow:"hidden",padding:"0 2px",children:(0,C.jsx)(w.ZP,{tableTitles:V,tableData:L,hasSearch:!1,onRowClick:H})})}),(0,C.jsx)(d.Z,{label:(0,p.t)("Select price"),error:N.price,children:(0,C.jsx)(b.ZP,{fillWidth:!0,style:{height:250},overflow:"hidden",padding:"0 2px",children:(0,C.jsx)(w.ZP,{tableTitles:x.po,tableData:X,hasSearch:!1,onRowClick:K})})})]})})}))}},758:function(t,e,n){n.d(e,{A7:function(){return o},QX:function(){return r},fK:function(){return l}});var a=n(3544),i=n(7049),o=[{top:{name:(0,a.t)("label"),getData:function(t){return t.label}},bottom:{name:(0,a.t)("code"),getData:function(t){return t.code}},width:"220px",action:"valueByPath"},{top:{name:(0,a.t)("type"),getData:function(t){return null===t||void 0===t?void 0:t.type}},width:"125px",action:"valueByPath"},{top:{name:(0,a.t)("email"),path:"email"},bottom:{name:(0,a.t)("phone"),path:"phone"},width:"180px",action:"contacts"},{top:{name:(0,a.t)("Address"),getData:function(t){return t.address||"\u043d\u0435 \u0432\u0438\u0437\u043d\u0430\u0447\u0435\u043d\u043e"}},bottom:{name:"".concat((0,a.t)("longitude"),"/").concat((0,a.t)("latitude")),getData:function(t){var e,n;return"".concat(((null===(e=t.location)||void 0===e?void 0:e.longitude)||"---")+", "+((null===(n=t.location)||void 0===n?void 0:n.latitude)||"---"))}},width:"175px",action:"valueByPath"},{top:{name:(0,a.t)("Manager"),getData:function(t){var e,n;return"".concat((null===(e=t.manager)||void 0===e||null===(n=e.user)||void 0===n?void 0:n.name)||"---")}},bottom:{name:(0,a.t)("email"),getData:function(t){var e,n;return"".concat((null===(e=t.manager)||void 0===e||null===(n=e.user)||void 0===n?void 0:n.email)||"---")}},width:"150px",action:"valueByPath"},{top:{name:(0,a.t)("updated"),align:"center",path:"updatedAt"},bottom:{name:(0,a.t)("created"),align:"center",path:"createdAt"},width:"150px",action:"dateSimple"}],r=[{top:{name:(0,a.t)("variationLabel"),getData:function(t){var e;return null===(e=t.variation)||void 0===e?void 0:e.label}},getImgPreview:function(t){var e,n,a;return null!==(e=t.offer)&&void 0!==e&&e.images?null===(n=t.offer)||void 0===n||null===(a=n.images[0])||void 0===a?void 0:a.img_preview:""},width:"270px",action:"doubleDataWithAvatar"},{top:{name:(0,a.t)("sku"),getData:function(t){var e;return null===(e=t.variation)||void 0===e?void 0:e.sku}},bottom:{name:(0,a.t)("barCode"),getData:function(t){var e;return null===(e=t.variation)||void 0===e?void 0:e.barCode}},width:"200px",action:"valueByPath"},{top:{name:(0,a.t)("type"),path:"type"},bottom:{name:(0,a.t)("status"),path:"status"},width:"120px",action:"status"},{top:{name:"\u041d\u0430\u044f\u0432\u043d\u0456\u0441\u0442\u044c",align:"end",getData:function(t){return t.stock||0}},bottom:{name:"\u0420\u0435\u0437\u0435\u0440\u0432",align:"end",getData:function(t){return t.reserved||0}},width:"150px",action:"valueByPath"},{top:{name:"\u041e\u0447\u0456\u043a\u0443\u0454\u0442\u044c\u0441\u044f",align:"end",getData:function(t){return(null===t||void 0===t?void 0:t.awaiting)||0}},bottom:{name:"\u0412\u0442\u0440\u0430\u0447\u0435\u043d\u043e",align:"end",getData:function(t){return(null===t||void 0===t?void 0:t.lost)||0}},width:"150px",action:"valueByPath"},{top:{name:(0,a.t)("warehouse"),getData:function(t){var e;return null===(e=t.warehouse)||void 0===e?void 0:e.label}},bottom:{name:(0,a.t)("code"),getData:function(t){var e;return null===(e=t.warehouse)||void 0===e?void 0:e.code}},width:"170px",action:"valueByPath"},{top:{name:"\u041e\u043f\u0438\u0441",path:"description"},width:"190px",action:"valueByPath"},{top:{name:"\u0410\u0432\u0442\u043e\u0440",path:"author.name"},bottom:{name:"\u0415\u043c\u0435\u0439\u043b",path:"author.email"},width:"190px",action:"valueByPath"},{top:{name:"\u0421\u0442\u0432\u043e\u0440\u0435\u043d\u043e",align:"center",path:"createdAt"},bottom:{name:"\u041e\u043d\u043e\u0432\u043b\u0435\u043d\u043e",align:"center",path:"updatedAt"},width:"150px",action:"dateSimple"}],d=[{top:{name:(0,a.t)("Price OUT"),align:"end",getData:function(t){var e;return(0,i.__)(Number((null===t||void 0===t||null===(e=t.price)||void 0===e?void 0:e.in)||0))}},bottom:{name:(0,a.t)("Price IN"),align:"end",getData:function(t){var e;return(0,i.__)(Number((null===t||void 0===t||null===(e=t.price)||void 0===e?void 0:e.out)||0))}},width:"170px",action:"valueByPath"},{top:{name:(0,a.t)("comment"),align:"start",path:"description"},width:"150px",action:"valueByPath"}],l=[{top:{name:(0,a.t)("batch")},width:"150px",action:"valueByPath"},{top:{name:(0,a.t)("warehouse"),getData:function(t){var e;return null===(e=t.warehouse)||void 0===e?void 0:e.label}},bottom:{name:(0,a.t)("code"),getData:function(t){var e;return null===(e=t.warehouse)||void 0===e?void 0:e.code}},width:"170px",action:"valueByPath"},{top:{name:(0,a.t)("Stock"),align:"end",getData:function(t){return t.stock||0}},bottom:{name:(0,a.t)("Reserved"),align:"end",getData:function(t){return t.reserved||0}},width:"150px",action:"valueByPath"},{top:{name:(0,a.t)("Awaiting"),align:"end",getData:function(t){return(null===t||void 0===t?void 0:t.awaiting)||0}},bottom:{name:(0,a.t)("Lost"),align:"end",getData:function(t){return(null===t||void 0===t?void 0:t.lost)||0}},width:"150px",action:"valueByPath"},{top:{name:(0,a.t)("updated"),align:"center",path:"updatedAt"},bottom:{name:(0,a.t)("created"),align:"center",path:"createdAt"},width:"150px",action:"dateSimple"}].concat(d)}}]);
//# sourceMappingURL=372.24a426d2.chunk.js.map