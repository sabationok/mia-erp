"use strict";(self.webpackChunkmia_erp=self.webpackChunkmia_erp||[]).push([[494],{3007:function(e,n,i){i.d(n,{B:function(){return P}});var t=i(1413),o=i(4925),l=i(9006),d=i(3691),a=i(2989),r=i(4990),u=i(107),s=i(6681),c=i(8095),f=i(3423),v=i(870),p=i(4343),m=i(1500),h=i(9994),g=i(1494),b=i(4897),x=i(7348),Z=i(3383),j=i(389),S=i(9964),y=i(3329),L=["formState","register","registerSelect","formValues","setValue","handleSubmit"],P=function(e){var n,i=e.defaultValues,P=e.edit,_=e.type,V=e.onSuccess,I=e._id,C=(0,g.useOfferLoadersProvider)(),O=C.isLoading,B=C.onLoading,D=(0,h.Z)(),E=(0,x.eO)(),F=(0,x.q$)(v.cA.COUNTERPARTIES).directory,M=(0,x.q$)(v.cA.BRANDS).directory,w=(0,a.hN)({defaultValues:(0,t.Z)((0,t.Z)({visible:!1,approved:d.Hb.pending},i),{},{type:_})}),k=w.formState.errors,A=w.register,K=w.registerSelect,R=w.formValues,q=w.setValue,J=w.handleSubmit,N=(0,o.Z)(w,L);return(0,y.jsx)(y.Fragment,{children:(0,y.jsxs)(l.h,{label:(0,u.t)("Base info"),isLoading:P?null===O||void 0===O?void 0:O.offer_update:null===O||void 0===O?void 0:O.offer_create,onSubmit:J((function(e){var n=(0,m.vg)(e,{ignorePaths:["measurement"]});P?D.updateById({data:{data:{data:n,_id:I}},onSuccess:V,onLoading:B("offer_update")}):D.create({data:{data:{data:n}},onSuccess:V,onLoading:B("offer_create")})})),onReset:N.reset,canSubmit:!0,expandable:!1,children:[(0,y.jsx)(S.Z,{value:null!==(n=null===R||void 0===R?void 0:R.type)&&void 0!==n?n:d.iv.GOODS,options:Z.LC,onSelect:function(e){return q("type",e.value)}}),(0,y.jsx)(r.Z,{label:(0,u.t)("label"),error:k.label,required:!0,children:(0,y.jsx)(s.ZP,(0,t.Z)((0,t.Z)({placeholder:(0,u.t)("label")},A("label")),{},{required:!0,autoFocus:!0}))}),(0,y.jsxs)(c.ZP,{fxDirection:"row",gap:12,fillWidth:!0,children:[(0,y.jsx)(r.Z,{label:(0,u.t)("sku"),error:k.sku,children:(0,y.jsx)(s.ZP,(0,t.Z)({placeholder:(0,u.t)("sku")},A("sku")))}),(0,y.jsx)(r.Z,{label:(0,u.t)("Bar-code"),error:k.barCode,children:(0,y.jsx)(s.ZP,(0,t.Z)({placeholder:(0,u.t)("Bar-code")},A("barCode")))})]}),(0,y.jsx)(f.Z,(0,t.Z)({},K("brand",{options:M,label:(0,u.t)("brand"),placeholder:(0,u.t)("selectBrand")}))),(0,y.jsx)(f.Z,(0,t.Z)({},K("warehouse",{options:E.list,label:(0,u.t)("Select warehouse"),placeholder:(0,u.t)("Select warehouse")}))),(0,y.jsx)(f.Z,(0,t.Z)({},K("supplier",{options:F,label:(0,u.t)("Select supplier"),placeholder:(0,u.t)("Select supplier")}))),(0,y.jsx)(f.Z,(0,t.Z)({},K("approved",{options:b.SQ,label:(0,u.t)("status"),placeholder:(0,u.t)("status"),onlyValue:!0,valuePath:"approved"}))),(0,y.jsx)(r.Z,{label:(0,u.t)("description"),error:k.description,children:(0,y.jsx)(p.Z,(0,t.Z)({placeholder:(0,u.t)("description")},A("description")))}),(0,y.jsx)(r.Z,{label:(0,u.t)("Visibility"),error:k.description,children:(0,y.jsx)(j.Z,{value:R.visible,onChange:function(e){q("visible",e,{shouldTouch:!0,shouldDirty:!0})}})})]})})}},5169:function(e,n,i){i.d(n,{Z:function(){return I}});var t=i(9439),o=i(9006),l=i(1413),d=i(7348),a=i(2791),r=i(8095),u=i(4990),s=i(107),c=i(3383),f=i(9953),v=i(2603),p=i(7802),m=i(51),h=i(459),g=i(3350),b=i(3665),x=i(4719),Z=i(3890),j=i(3329),S=function(e){e.selected,e.onSelect;var n=e.filterValue,i=void 0===n?{type:v.h.OFFER}:n,o=e.onChangeIds,S=e.value,y=e.hideFilter,L=(0,g.Fg)(),P=(0,m.TL)(),_=(0,d.n6)(),V=(0,b.kw)(),I=(0,a.useState)(i),C=(0,t.Z)(I,2),O=C[0],B=C[1],D=(0,a.useMemo)((function(){var e,n=O.type;return null===(e=_.listsMap)||void 0===e?void 0:e[n]}),[O.type,_.listsMap]);(0,a.useEffect)((function(){null!==D&&void 0!==D&&D.length||P((0,h.Sn)({params:{type:O.type}}))}),[P,O.type,D,null===D||void 0===D?void 0:D.length]);return(0,j.jsxs)(r.ZP,{gap:8,children:[(0,j.jsx)(r.ZP,{fxDirection:"row",gap:8,padding:"0 8px 8px",borderBottom:"1px solid ".concat(L.modalBorderColor),justifyContent:"flex-end",children:(0,j.jsx)(Z.Z,{actions:[{title:(0,s.t)("Create"),onPress:function(){V.create(x.Z,{defaultValues:{type:O.type}})}}]})}),!y&&(0,j.jsx)(u.Z,{label:(0,s.t)("Select tags group"),children:(0,j.jsx)(f.Z,{options:c.fz,defaultValue:O.type,onSelect:function(e){var n=e.value;n&&B((function(e){return(0,l.Z)((0,l.Z)({},e),{},{type:n})}))}})}),(0,j.jsx)(p.Z,{multiple:!0,options:D,onChangeIds:o,value:S})]})},y=i(2989),L=i(1494),P=i(1500),_=i(1819),V=i(763),I=function(e){var n,i=e.disabled,l=e.offer,d=(0,y.G2)(l),r=(0,L.useOfferLoadersProvider)(),u=(0,P.sK)(null===d||void 0===d||null===(n=d.tags)||void 0===n?void 0:n.map((function(e){return e._id}))),s=(0,_.xc)()[_.EJ.offers],c=(0,a.useState)(u),f=(0,t.Z)(c,2),p=f[0],m=f[1],h=(0,a.useMemo)((function(){return!(null===p||void 0===p||!p.length)&&(null===u||void 0===u?void 0:u.join(","))!==(0,P.sK)(p).join(",")}),[u,p]);return(0,a.useEffect)((function(){null!==d&&void 0!==d&&d.tags&&m((0,P.SJ)(null===d||void 0===d?void 0:d.tags))}),[]),(0,j.jsx)(o.h,{label:"Tags",isOpen:!1,disabled:i,onSubmit:function(e){e.preventDefault(),e.stopPropagation(),d&&s.updateById({onLoading:r.onLoading("tags"),data:{data:{_id:d._id,data:{tagsIds:p}}}})},canSubmit:h,isLoading:r.isLoading.tags,children:(0,j.jsx)(S,{filterValue:{type:v.h.OFFER},hideFilter:!0,value:p,onChangeIds:function(e){var n=e.value;m((0,V.isArray)(n)?n:[n])}})})}},7608:function(e,n,i){i.d(n,{A:function(){return g}});var t,o=i(168),l=i(9439),d=i(2791),a=i(9006),r=i(3350),u=i(8095),s=i(1819),c=i(1494),f=i(107),v=i(1500),p=i(9184),m=i(2989),h=i(3329),g=function(e){var n,i,t=e.offer,o=e.disabled,r=(0,m.G2)(t),u=(0,c.useOfferLoadersProvider)(),g=(0,v.sK)(null===r||void 0===r||null===(n=r.categories)||void 0===n?void 0:n.map((function(e){return e._id}))),x=(0,s.xc)()[s.EJ.offers],Z=(0,d.useState)(g),j=(0,l.Z)(Z,2),S=j[0],y=j[1],L=(0,d.useMemo)((function(){return!(null===S||void 0===S||!S.length)&&(null===g||void 0===g?void 0:g.join(","))!==(0,v.sK)(S).join(",")}),[g,S]);return(0,d.useEffect)((function(){null!==r&&void 0!==r&&r.categories&&y((0,v.SJ)(null===r||void 0===r?void 0:r.categories))}),[]),(0,h.jsx)(a.h,{label:(0,f.t)("Categories"),onSubmit:function(e){e.preventDefault(),r&&x.updateById({onLoading:u.onLoading("categories"),data:{data:{_id:r._id,data:{categoriesIds:S}}},onSuccess:function(e,n){}})},disabled:o,isLoading:null===(i=u.isLoading)||void 0===i?void 0:i.categories,canSubmit:L,maxHeight:"300px",isOpen:!1,children:(0,h.jsx)(b,{flex:1,overflow:"auto",children:(0,h.jsx)(p.Z,{onChangeIds:y,offer:r})})})},b=(0,r.ZP)(u.j6)(t||(t=(0,o.Z)(["\n  padding-bottom: 8px;\n"])))},9420:function(e,n,i){i.d(n,{A:function(){return y}});var t,o=i(1413),l=i(9439),d=i(4925),a=i(168),r=i(107),u=i(2791),s=i(8095),c=i(4990),f=i(6681),v=i(3350),p=i(3329),m=[{name:"height",label:(0,r.t)("Height"),placeholder:(0,r.t)("Sm")},{name:"width",label:(0,r.t)("Width"),placeholder:(0,r.t)("Sm")},{name:"length",label:(0,r.t)("Length"),placeholder:(0,r.t)("Sm")},{name:"weight",label:(0,r.t)("Weight"),placeholder:(0,r.t)("Kg")}],h=(0,v.ZP)(s.ZP)(t||(t=(0,a.Z)(["\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  column-gap: 8px;\n\n  @media screen and (min-width: 480px) {\n    grid-template-columns: repeat(4, 1fr);\n  }\n"]))),g=function(e){var n,i,t=e.form,l=e.disabled,d=null===t||void 0===t||null===(n=t.formState)||void 0===n||null===(i=n.errors)||void 0===i?void 0:i.dimensions;return(0,p.jsx)(h,{fillWidth:!0,children:m.map((function(e){return(0,p.jsx)(c.Z,{label:e.label,error:d&&d[e.name],children:(0,p.jsx)(f.ZP,(0,o.Z)((0,o.Z)({placeholder:e.placeholder,min:1,type:"number"},t.register("dimensions.".concat(e.name),{valueAsNumber:!0,min:1})),{},{disabled:l}))},e.name)}))})},b=i(2989),x=i(9006),Z=i(9994),j=i(7843),S=["defaultValues","_id","disabled"],y=function(e){var n,i,t,a=e.defaultValues,s=e._id,c=e.disabled,f=(0,d.Z)(e,S),v=(0,Z.Z)(),m=(0,u.useState)(!1),h=(0,l.Z)(m,2),y=h[0],L=h[1],P=(0,b.hN)({defaultValues:{dimensions:null!==a&&void 0!==a?a:{}}}),_=!(null===(n=P.formState.dirtyFields)||void 0===n||!n.dimensions)&&(null===(i=Object.values(null===(t=P.formState.dirtyFields)||void 0===t?void 0:t.dimensions))||void 0===i?void 0:i.some((function(e){return e})));return(0,p.jsx)(x.h,(0,o.Z)((0,o.Z)({onSubmit:P.handleSubmit((function(e){v.updateById({data:{data:{data:e,_id:s}},onSuccess:function(e){j.kl.success("Product updated")},onError:function(e){console.error("Product update action",e)},onLoading:L})})),label:(0,r.t)("Package size"),isLoading:y,isOpen:!1},f),{},{disabled:!_||c,children:(0,p.jsx)(g,{form:P,disabled:c})}))}},5888:function(e,n,i){i.d(n,{A:function(){return v}});var t=i(1413),o=i(9439),l=i(1494),d=i(1819),a=i(2791),r=i(9006),u=i(8926),s=i(1500),c=i(107),f=i(3329),v=function(e){var n,i,v=e.offer,p=e.onSubmit,m=e.onSuccess,h=e.disabled,g=e.defaultValues,b=(0,l.useOfferLoadersProvider)(),x=(0,a.useState)(g||(null===b||void 0===b||null===(n=b.state)||void 0===n?void 0:n.images)||[]),Z=(0,o.Z)(x,2),j=Z[0],S=Z[1],y=(0,d.xc)()[d.EJ.offers],L=(0,a.useMemo)((function(){return!(null===j||void 0===j||!j.length)}),[null===j||void 0===j?void 0:j.length]);return(0,f.jsx)(r.h,{label:(0,c.t)("Images"),onSubmit:function(e){e.preventDefault(),e.stopPropagation(),p?p(j):v?y.updateById({data:{refresh:!0,data:(0,t.Z)((0,t.Z)({},(0,s.rE)(v)),{},{data:{images:j}})},onSuccess:m,onLoading:b.onLoading("images")}):console.warn("Offer not passed")},canSubmit:L,disabled:h,isLoading:null===(i=b.isLoading)||void 0===i?void 0:i.images,isOpen:!1,maxHeight:"400px",children:(0,f.jsx)(u.Z,{hideLabel:!0,initialData:j,onChangeState:S,contentContainerStyle:{flex:1}})})}},9306:function(e,n,i){i.d(n,{n:function(){return y}});var t=i(1413),o=i(9439),l=i(4925),d=i(8553),a=i(3423),r=i(4990),u=i(6681),s=i(8095),c=i(2791),f=i(107),v=i(3096),p=i(3329),m=(0,d.H1)(v.q),h=[{name:"measurement.unit",label:(0,f.t)("unit"),placeholder:(0,f.t)("unit"),options:m},{name:"measurement.min",label:(0,f.t)("min"),placeholder:(0,f.t)("min"),type:"number"},{name:"measurement.max",label:(0,f.t)("max"),placeholder:(0,f.t)("max"),type:"number"}],g=function(e){var n=e.appForm,i=e.disabled;return(0,p.jsx)(s.ZP,{fillWidth:!0,style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr",columnGap:8},children:h.map((function(e){var o;return e.options?(0,p.jsx)(a.Z,(0,t.Z)((0,t.Z)({},n.registerSelect(null===e||void 0===e?void 0:e.name,{options:null===e||void 0===e?void 0:e.options,label:null===e||void 0===e?void 0:e.label,placeholder:null===e||void 0===e?void 0:e.label,onlyValue:!0})),{},{disabled:i}),e.name):(0,p.jsx)(r.Z,{label:e.label,error:null===n||void 0===n||null===(o=n.formState)||void 0===o?void 0:o.errors[e.name],children:(0,p.jsx)(u.ZP,(0,t.Z)((0,t.Z)({placeholder:e.placeholder,min:"number"===(null===e||void 0===e?void 0:e.type)?1:void 0,type:null===e||void 0===e?void 0:e.type},n.register(e.name,{valueAsNumber:"number"===(null===e||void 0===e?void 0:e.type),min:"number"===(null===e||void 0===e?void 0:e.type)?1:void 0})),{},{disabled:i}))},e.name)}))})},b=i(2989),x=i(9006),Z=i(9994),j=i(7843),S=["defaultValues","_id","disabled"],y=function(e){var n,i,d,a=e.defaultValues,r=e._id,u=e.disabled,s=(0,l.Z)(e,S),v=(0,Z.Z)(),m=(0,c.useState)(!1),h=(0,o.Z)(m,2),y=h[0],L=h[1],P=(0,b.hN)({defaultValues:{measurement:a}}),_=!(null===(n=P.formState.dirtyFields)||void 0===n||!n.measurement)&&(null===(i=Object.values(null===(d=P.formState.dirtyFields)||void 0===d?void 0:d.measurement))||void 0===i?void 0:i.some((function(e){return e})));return(0,p.jsx)(x.h,(0,t.Z)((0,t.Z)({onSubmit:P.handleSubmit((function(e){v.updateById({data:{data:{data:e,_id:r}},update:!0,onSuccess:function(e){j.kl.success("Product updated")},onError:function(e){console.error("Product update action",e)},onLoading:L})})),label:(0,f.t)("Measurement info"),isLoading:y,disabled:!_||u,isOpen:!1},s),{},{children:(0,p.jsx)(g,{appForm:P,disabled:u})}))}},8782:function(e,n,i){i.d(n,{R:function(){return j}});var t,o=i(168),l=i(7762),d=i(9439),a=i(2791),r=i(9006),u=i(3350),s=i(8095),c=i(7348),f=i(1819),v=i(1494),p=i(107),m=i(2825),h=i(4809),g=i(6492),b=i(2989),x=i(1500),Z=i(3329),j=function(e){var n,i,t=e.onSuccess,o=e.disabled,u=e.offer,j=(0,v.useOfferLoadersProvider)(),y=(0,c.i7)(),L=(0,b.G2)(u),P=(0,f.xc)().get(f.EJ.offers),_=(0,x.sK)(null===L||void 0===L||null===(n=L.properties)||void 0===n?void 0:n.map((function(e){return e._id}))),V=(0,a.useState)(_),I=(0,d.Z)(V,2),C=I[0],O=I[1],B=(0,a.useState)(),D=(0,d.Z)(B,2),E=D[0],F=D[1],M=(0,a.useMemo)((function(){var e;return!(null===C||void 0===C||!C.length)&&(null===_||void 0===_?void 0:_.join(","))!==(null===(e=(0,x.sK)(C))||void 0===e?void 0:e.join(","))}),[C,_]),w=(0,a.useMemo)((function(){var e,n,i;if(null!==E&&void 0!==E&&null!==(e=E.childrenList)&&void 0!==e&&e.length)return null===E||void 0===E?void 0:E.childrenList.filter((function(e){return!(null!==e&&void 0!==e&&e.isSelectable)}));var t,o=null===E||void 0===E?void 0:E._id,d=[],a=null!==(n=null===(i=y.propertiesKeysMap)||void 0===i?void 0:i[null!==o&&void 0!==o?o:"def"])&&void 0!==n?n:[],r=(0,l.Z)(a);try{for(r.s();!(t=r.n()).done;){var u,s=t.value,c=null===(u=y.propertiesDataMap)||void 0===u?void 0:u[s];if(c&&(null===c||void 0===c||!c.isSelectable)){var f=y.propertiesKeysMap[null===c||void 0===c?void 0:c._id];null!==f&&void 0!==f&&f.length&&d.push(c)}}}catch(v){r.e(v)}finally{r.f()}return d}),[E,y.propertiesDataMap,y.propertiesKeysMap]),k=(0,a.useCallback)((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";O((function(e){return(0,x.ES)({arr:e,id:n,toggle:!0})}))}),[]),A=(0,a.useMemo)((function(){return null===w||void 0===w?void 0:w.map((function(e){return(0,Z.jsx)(h.Z,{item:e,selectedIds:C,onSelect:k},"prop_".concat(e._id))}))}),[w,C,k]);return(0,Z.jsxs)(r.h,{label:(0,p.t)("Properties"),canSubmit:M,onSubmit:function(e){e.preventDefault(),e.stopPropagation(),L&&P.updateById({data:{data:{_id:null===L||void 0===L?void 0:L._id,data:{propertiesIds:C,templateId:null===E||void 0===E?void 0:E._id}}},update:!0,onLoading:j.onLoading("properties"),onSuccess:t})},isLoading:null===(i=j.isLoading)||void 0===i?void 0:i.properties,isOpen:!1,disabled:!L||o,children:[(0,Z.jsx)(m.c,{selected:E,onSelect:F}),(0,Z.jsx)(S,{flex:1,overflow:"auto",children:null!==A&&void 0!==A&&A.length?A:(0,Z.jsx)(s.ZP,{padding:"24px",alignItems:"center",justifyContent:"center",children:(0,Z.jsx)(g.x,{$size:16,children:(0,p.t)("Data not found")})})})]})},S=(0,u.ZP)(s.ZP)(t||(t=(0,o.Z)(["\n  padding-bottom: 8px;\n"])))},1494:function(e,n,i){i.r(n),i.d(n,{useOfferLoadersProvider:function(){return j}});var t=i(9420),o=i(8050),l=i(107),d=i(1500),a=i(2791),r=i(9306),u=i(3007),s=i(8095),c=i(8782),f=i(9541),v=i(7578),p=i(5888),m=i(2989),h=i(7608),g=i(5248),b=i(5169),x=i(3331),Z=i(3329),j=function(){return(0,v.un)()};n.default=function(e){var n,i=e.onClose,j=(e._id,(0,f.J)()),S=j.state.formData,y=j.setData,L=(0,m.xj)(),P=(0,m.G2)({_id:null===(n=L.query)||void 0===n?void 0:n.offerId});return(0,a.useEffect)((function(){}),[]),(0,Z.jsx)(o.Z,{title:(0,l.t)("Create offer"),onClose:i,children:(0,Z.jsx)(v.f4,{value:j,children:(0,Z.jsxs)(s.ZP,{padding:"0 8px 16px",children:[(0,Z.jsx)(u.B,{defaultValues:S,onSuccess:function(e){var n=e.data;y("formData",(0,d.xT)(n)),L.push({query:{offerId:null===n||void 0===n?void 0:n._id}})},type:null===S||void 0===S?void 0:S.type}),P&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(h.A,{offer:P,defaultValues:null===S||void 0===S?void 0:S.categoriesIds,disabled:!S}),(0,Z.jsx)(c.R,{offer:P,defaultValues:null===S||void 0===S?void 0:S.propertiesIds,disabled:!S}),(0,Z.jsx)(g.L,{expandable:!!P,isOpen:!1,offer:P,defaultState:null===P||void 0===P?void 0:P.price,price:null===P||void 0===P?void 0:P.price,title:(0,l.t)("Price")}),(null===P||void 0===P?void 0:P.price)&&(0,Z.jsx)(x.Z,{price:null===P||void 0===P?void 0:P.price}),(0,Z.jsx)(p.A,{offer:P,defaultValues:null===S||void 0===S?void 0:S.images,disabled:!S}),(0,Z.jsx)(b.Z,{offer:P,defaultValues:null===S||void 0===S?void 0:S.tagsIds,disabled:!S}),(0,Z.jsx)(t.A,{offer:P,defaultValues:null===S||void 0===S?void 0:S.dimensions,disabled:!S}),(0,Z.jsx)(r.n,{offer:P,defaultValues:null===S||void 0===S?void 0:S.measurement,disabled:!S})]})]})})})}}}]);
//# sourceMappingURL=494.49941d21.chunk.js.map